<!--
If you want to include any custom html just before </body>, put it in /layouts/partials/extended_footer.html
Do not put anything in this file - it's only here so that hugo won't throw an error if /layouts/partials/extended_footer.html doesn't exist.
-->

{{ partialCached "donatebutton.html" .}}

{{ $mainjs := ("assets/main.js" | absURL) }}
<script>
    function loadMainJS() {
        var scriptTag = document.createElement('script');
        scriptTag.src = "{{ $mainjs }}";
        scriptTag.setAttribute('async', '');
        scriptTag.setAttribute('fetchpriority', 'high');
        document.body.appendChild(scriptTag);
    }

    yieldToMain(function() {
      loadMainJS();
    }, "user-blocking");
</script>

{{ $disabledURLs := slice "/about" "/contact" "/terms" "/privacy" "/advertise" "/guest-posts"}}
{{ $currentPath := .Permalink }}
{{ $disablePrism := false }}
{{ range $disabledURLs }}
  {{ if (in $currentPath .) }}
    {{ $disablePrism = true }}
  {{ end }}
{{ end }}
{{ if not $disablePrism }}
  {{ if not (eq .Params.Comments.enable false) }}
    {{ if and (not .IsHome) (not .IsSection) (.IsPage)}}
      {{ $prismjs := ("assets/prism.js" | absURL) }}
      <script>
          // Function to load the script asynchronously at DOMContentLoaded
          function loadPrismJS() {
              var scriptTag = document.createElement('script');
              scriptTag.src = "{{ $prismjs }}";
              scriptTag.setAttribute('defer', '');
              scriptTag.setAttribute('media', '(min-width: 769px)');
              scriptTag.setAttribute('fetchpriority', 'high');
              document.body.appendChild(scriptTag);
          }

          // Use yieldToMain() with DOMContentLoaded event
          document.addEventListener('DOMContentLoaded', function () {
              yieldToMain(function() {
                loadPrismJS();
              }, "background");
          });
      </script>
    {{ end }}
  {{ end }}
{{ end }}

<!-- Scroll to Top Button -->
<button onclick="topFunction()" id="myBtn" title="Go to top">^</button>

<script>
  let isScrolling = false;
  const mybutton = document.getElementById("myBtn");
  
  // Add a scroll event listener to the window with debouncing
  window.addEventListener('scroll', debounceScrollFunction);
  
  // Define the scroll function with debouncing
  function debounceScrollFunction() {
    if (!isScrolling) {
      isScrolling = true;
      requestAnimationFrame(scrollFunction);
    }
  }
  
  // Define the scroll function
  function scrollFunction() {
    mybutton.style.display = (window.scrollY > 20) ? 'block' : 'none';
    isScrolling = false;
  }
  
  // Define the topFunction with smooth scrolling
  function topFunction() {
    const currentY = window.scrollY;
    const step = Math.max(currentY / 30, 10); // 30 steps with a minimum step of 10
    requestAnimationFrame(function scrollToTop() {
      if (window.scrollY > 0) {
        window.scrollBy(0, -step);
        requestAnimationFrame(scrollToTop);
      }
    });
  }
</script>

{{ partial "editbutton.html" . }}

{{ $style := resources.Get "style-append.css" | resources.Minify }}
<link rel="stylesheet" href="{{ $style.Permalink }}" fetchpriority="high">

<!-- Load Service Worker -->
{{ partialCached "load_service_worker.html" . }}

<!-- Load 3rd Party JS -->
{{ if not $.Site.IsServer }}
    <!-- Global site tag (gtag.js) - Google Analytics -->
    {{ template "_internal/google_tag_manager.html" . }}

    <!-- Microsoft Clarity -->
    {{ template "_internal/microsoft_clarity.html" . }}
    {{ if not .IsHome }}
      <!-- Load Info Links -->
      {{ if not .IsSection }}
        <!-- Ads JS Load -->
        {{ partialCached "googleadsload.html" . }}
        {{ partialCached "infolinks.html" . }}
      {{ end }}
    {{ end }}
{{ end }}