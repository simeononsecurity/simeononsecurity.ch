<!doctype html><html lang=en><head><title>Hardening Apache Web Server :: simeononsecurity — a security and automation blog</title><meta property="og:title" content="Hardening Apache Web Server"><meta property="og:description" content="A collection of example configurations and scripts to aid system administrators in hardening Apache web servers. Apache, out of the box, is surprisingly insecure. Many best practices and security configurations have to be configured manually before rolling Apache out in a production environment. You may use this GitHub repository as a starting point towards securing your Apache instances.
Installing ModSecurity with OWASP Core Rule Set Step 1: Update Repositories On Ubuntu/ Debian:"><meta property="og:type" content="article"><meta property="og:url" content="/github/hardening-apache/"><meta property="og:locale" content="en_US"><meta property="og:site_name" content="SimeonOnSecurity"><meta property="og:image" content="/img/banner.png"><meta property="article:published_time" content="2020-07-27T10:15:03-07:00"><meta property="article:modified_time" content="2020-11-14T22:09:01-06:00"><meta property="og:site_name" content="simeononsecurity"><base href=../../github/hardening-apache/><link rel=canonical href=../../github/hardening-apache/ itemprop=url><title itemprop=name>Hardening Apache Web Server | simeononsecurity</title><meta charset=utf-8><meta itemprop=description content="A collection of example configurations and scripts to aid system administrators in hardening Apache web servers. Apache, out of the box, is surprisingly insecure. Many best practices and security configurations have to be configured manually before rolling Apache out in a production environment. You may use this GitHub repository as a starting point towards securing your Apache instances.
Installing ModSecurity with OWASP Core Rule Set Step 1: Update Repositories On Ubuntu/ Debian:"><meta itemprop=name content="Hardening Apache Web Server | simeononsecurity"><meta name=HandheldFriendly content="True"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=apple-mobile-web-app-title content="SimeonOnSecurity"><meta name=apple-touch-fullscreen content="yes"><meta name=application-name content="Hardening Apache Web Server | simeononsecurity"><meta name=copyright content="SimeonOnSecurity"><meta name=coverage content="Worldwide"><meta name=description content="A collection of example configurations and scripts to aid system administrators in hardening Apache web servers. Apache, out of the box, is surprisingly insecure. Many best practices and security configurations have to be configured manually before rolling Apache out in a production environment. You may use this GitHub repository as a starting point towards securing your Apache instances.
Installing ModSecurity with OWASP Core Rule Set Step 1: Update Repositories On Ubuntu/ Debian:"><meta name=distribution content="Global"><meta name=googlebot content="index,follow"><meta name=imagemode content="force"><meta name=keywords content="Automation,Bash,Hardening Apache,Apache Web Server,Hardening SSL,SSL,Script,"><meta name=msapplication-TileColor content="#141414"><meta name=msapplication-tap-highlight content="no"><meta name=revisit-after content="1 days"><meta name=robots content="index,follow" content="all"><meta name=theme-color content="#141414"><meta name=url content="/github/hardening-apache/"><meta name=viewport content="width=device-width,initial-scale=1"><meta itemprop=datePublished content="2020-07-27T10:15:03-07:00"><meta itemprop=dateModified content="2020-11-14T22:09:01-06:00"><meta itemprop=wordCount content="455"><meta itemprop=image content="/img/banner.png"><meta itemprop=keywords content="Automation,Bash,Hardening Apache,Apache Web Server,Hardening SSL,SSL,Script,"><link rel=sitemap type=application/xml title=Sitemap href=../../sitemap.xml><meta name=twitter:url content="/github/hardening-apache/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/img/banner.png"><meta name=twitter:title content="Hardening Apache Web Server"><meta name=twitter:description content="A collection of example configurations and scripts to aid system administrators in hardening Apache web servers. Apache, out of the box, is surprisingly insecure. Many best practices and security configurations have to be configured manually before rolling Apache out in a production environment. You may use this GitHub repository as a starting point towards securing your Apache instances.
Installing ModSecurity with OWASP Core Rule Set Step 1: Update Repositories On Ubuntu/ Debian:"><link rel=stylesheet href=../../css/style.min.css><link rel=stylesheet href=../../style.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=../../img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=../../img/favicon.png><link rel=icon href=../../img/favicon.ico type=image/x-icon><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/img/banner.png"><meta name=twitter:title content="Hardening Apache Web Server"><meta name=twitter:description content="A collection of example configurations and scripts to aid system administrators in hardening Apache web servers. Apache, out of the box, is surprisingly insecure. Many best practices and security configurations have to be configured manually before rolling Apache out in a production environment. You may use this GitHub repository as a starting point towards securing your Apache instances.
Installing ModSecurity with OWASP Core Rule Set Step 1: Update Repositories On Ubuntu/ Debian:"><meta property="og:title" content="Hardening Apache Web Server"><meta property="og:description" content="A collection of example configurations and scripts to aid system administrators in hardening Apache web servers. Apache, out of the box, is surprisingly insecure. Many best practices and security configurations have to be configured manually before rolling Apache out in a production environment. You may use this GitHub repository as a starting point towards securing your Apache instances.
Installing ModSecurity with OWASP Core Rule Set Step 1: Update Repositories On Ubuntu/ Debian:"><meta property="og:type" content="article"><meta property="og:url" content="/github/hardening-apache/"><meta property="og:image" content="/img/banner.png"><meta property="article:published_time" content="2020-07-27T10:15:03-07:00"><meta property="article:modified_time" content="2020-11-14T22:09:01-06:00"><meta property="og:site_name" content="simeononsecurity"><link rel=alternate type=application/rss+xml title=simeononsecurity href=../../sitemap.xml><script data-ad-client=ca-pub-4092442123207538 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-173461240-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-173461240-1',{'anonymize_ip':true});ga('set','userId','USER_ID');gtag('set',{'user_id':'USER_ID'});</script></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=../../ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>simeononsecurity</span>
<span class=logo__cursor></span></a><span class=header__right><nav class=menu><ul class="menu__inner menu__inner--desktop"><ul class=menu__sub-inner><li class=menu__sub-inner-more-trigger>Show more
<span class=menu__sub-inner-more-trigger-icon><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span></li><ul class="menu__sub-inner-more hidden"><li><a href=../../about>About</a></li><li><a href=../../blog>Blog</a></li><li><a href=../../ctfranks>CTF Rankings</a></li><li><a href=../../github>GitHub</a></li><li><a href=../../recommendhome>Recommendations</a></li><li><a href=../../til>Today I Learned</a></li><li><a href=../../writeups>Writeups</a></li></ul></ul></ul><ul class="menu__inner menu__inner--mobile"><li><a href=../../about>About</a></li><li><a href=../../blog>Blog</a></li><li><a href=../../ctfranks>CTF Rankings</a></li><li><a href=../../github>GitHub</a></li><li><a href=../../recommendhome>Recommendations</a></li><li><a href=../../til>Today I Learned</a></li><li><a href=../../writeups>Writeups</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41C32.4934 41 41 32.4934 41 22 41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><div class=post><h1 class=post-title><a href=../../github/hardening-apache/>Hardening Apache Web Server</a></h1><div class=post-meta><span class=post-date>2020-07-27</span></div><span class=post-tags>#<a href=../../tags/automation/>Automation</a>&nbsp;
#<a href=../../tags/bash/>Bash</a>&nbsp;
#<a href=../../tags/hardening-apache/>Hardening Apache</a>&nbsp;
#<a href=../../tags/apache-web-server/>Apache Web Server</a>&nbsp;
#<a href=../../tags/hardening-ssl/>Hardening SSL</a>&nbsp;
#<a href=../../tags/ssl/>SSL</a>&nbsp;
#<a href=../../tags/script/>Script</a>&nbsp;</span><div class=post-content><h3 id=a-collection-of-example-configurations-and-scripts-to-aid-system-administrators-in-hardening-apache-web-servers>A collection of example configurations and scripts to aid system administrators in hardening Apache web servers.</h3><p>Apache, out of the box, is surprisingly insecure. Many best practices and security configurations have to be configured manually before rolling Apache out in a production environment. You may use this GitHub repository as a starting point towards securing your Apache instances.</p><h2 id=installing-modsecurity-with-owasp-core-rule-set>Installing ModSecurity with OWASP Core Rule Set</h2><h3 id=step-1-update-repositories>Step 1: Update Repositories</h3><p><strong>On Ubuntu/ Debian:</strong></p><pre><code>sudo apt-get update -y
</code></pre><p><strong>On CentOS/RHEL:</strong></p><pre><code>sudo yum update -y
</code></pre><h3 id=step-2-installing-modsecurity-for-apache>Step 2: Installing ModSecurity for Apache</h3><p><strong>On Ubuntu/ Debian:</strong></p><pre><code>sudo apt-get install -y libapache2-modsecurity
sudo systemctl restart apache2
</code></pre><p><strong>On CentOS/RHEL:</strong></p><pre><code>sudo yum install -y mod_security
sudo systemctl restart httpd.service
</code></pre><h3 id=step-3-configure-modsecurity>Step 3: Configure ModSecurity</h3><p>ModSecurity by default is only configured to log events from the default rules. We&rsquo;ll have to edit the configuration file to modify the rules to detect and block malicious traffic.</p><p><strong>Copy and rename the file:</strong></p><pre><code>sudo cp /etc/modsecurity/modsecurity.conf-recommended /etc/modsecurity/modsecurity.conf
</code></pre><p><strong>Change the ModSecurity detection mode by editing the configuration file:</strong></p><pre><code>sudo nano /etc/modsecurity/modsecurity.conf
</code></pre><p>Change &ldquo;DetectionOnly&rdquo; to &ldquo;On&rdquo;</p><pre><code>SecRuleEngine DetectionOnly
</code></pre><pre><code>SecRuleEngine On
</code></pre><p>If you&rsquo;re using nano you may hit <strong>CTRL+X</strong>, then <strong>Y</strong> and <strong>Enter</strong> to save and exit.</p><p><strong>Restart Apache</strong></p><p>On Ubuntu\ Debian:</p><pre><code>sudo systemctl restart apache2
</code></pre><p>On CentOS\ RHEL:</p><pre><code>sudo systemctl restart httpd.service
</code></pre><h3 id=step-4-downloading-and-installing-owasp-modsecurity-core-rule-set>Step 4: Downloading and Installing OWASP ModSecurity Core Rule Set</h3><pre><code>cd /apache/conf
wget https://github.com/coreruleset/coreruleset/archive/v3.3.0.tar.gz
tar -xvzf v3.3.0.tar.gz
sudo ln -s coreruleset-3.3.0 /apache/conf/crs
cp crs/crs-setup.conf.example crs/crs-setup.conf
rm v3.3.0.tar.gz
</code></pre><p><strong>Restart Apache</strong></p><p>On Ubuntu\ Debian:</p><pre><code>sudo systemctl restart apache2
</code></pre><p>On CentOS\ RHEL:</p><pre><code>sudo systemctl restart httpd.service
</code></pre><h3 id=step-5-additional-reading-material>Step 5: Additional Reading Material</h3><p><strong>Additional installation instructions:</strong></p><p><a href=https://owasp.org/www-project-modsecurity-core-rule-set/>Install OWASP ModSecurity Core Rule Set</a></p><p><a href=https://phoenixnap.com/kb/setup-configure-modsecurity-on-apache>Install ModSecurity</a></p><h2 id=ssl-certificates>SSL Certificates</h2><h3 id=self-signed>Self Signed</h3><p>Following the instructions from <a href=https://www.digitalocean.com/community/tutorials/how-to-create-a-self-signed-ssl-certificate-for-apache-in-ubuntu-16-04>Digital Ocean</a></p><p>For this tutorial, I&rsquo;m assuming you&rsquo;re going to be using the <strong>example.com.conf</strong> file from the repository.</p><h4 id=step-1-create-the-ssl-certificate>Step 1: Create the SSL certificate</h4><pre><code>sudo openssl req -x509 -nodes -days 365 -newkey rsa:4096 -keyout /etc/ssl/private/apache-selfsigned.key -out /etc/ssl/certs/apache-selfsigned.crt
</code></pre><p><strong>Fill out the prompts appropriately. The most important line is the one that requests the Common Name (e.g. server FQDN or YOUR name). You need to enter the domain name associated with your server or, more likely, your server’s public IP address.</strong>
If using for the IP access only certificate in the example.com.conf please use <strong>&ldquo;NA&rdquo;</strong> for all values where posible.</p><h4 id=perfect-forward-secrecy-configuration>Perfect Forward Secrecy Configuration</h4><pre><code>sudo openssl dhparam -out /etc/ssl/certs/dhparam.pem 4096
</code></pre><h3 id=automate-with-letsencrypt-and-certbot>Automate with LetsEncrypt and Certbot</h3><p>Following the tutorial from <a href=https://certbot.eff.org/lets-encrypt/ubuntubionic-apache.html>Certbot</a></p><h4 id=step-1-install-certbot>Step 1: Install Certbot</h4><pre><code>sudo apt-get update -y
sudo apt-get install software-properties-common
sudo add-apt-repository universe
sudo add-apt-repository ppa:certbot/certbot
sudo apt-get update
sudo apt-get install -y certbot python3-certbot-apache
</code></pre><h3 id=step-2-choose-how-youd-like-to-run-certbot>Step 2: Choose how you&rsquo;d like to run Certbot</h3><h5 id=either-get-and-install-your-certificates>Either get and install your certificates&mldr;</h5><pre><code>sudo certbot --apache
</code></pre><h5 id=or-just-get-a-certificate>Or, just get a certificate</h5><pre><code>sudo certbot certonly --apache
</code></pre><h4 id=step-3-test-automatic-renewal>Step 3: Test automatic renewal</h4><pre><code>sudo certbot renew --dry-run
</code></pre></div></div></div><footer class=footer><div class=footer__inner><div><span><a href=../../contactus/ target=_blank rel=noopener>Contact</a></span></span></div><div><span><a href=../../privacypolicy/ target=_blank rel=noopener>Privacy</a></span></div><div><span><a href=../../termsandconditions/ target=_blank rel=noopener>Terms</a></span></span></div><div><span><a href=../../sitemap.xml target=_blank rel=noopener>Sitemap</a></span></span></div><div><span><a href=../../index.xml target=_blank rel=noopener>RSS</a></span></span></div><div class=copyright><span>© 2021 SimeonOnSecurity</span></div></div></footer><script src=../../js/menu.js></script><script src=../../js/theme.js></script><script src=../../js/prism.js></script></div></body></html>