<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>Hardening Apache Web Server :: simeononsecurity — a security and automation blog</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="A collection of example configurations and scripts to aid system administrators in hardening Apache web servers. Apache, out of the box, is surprisingly insecure. Many best practices and security configurations have to be configured manually before rolling Apache out in a production environment. You may use this GitHub repository as a starting point towards securing your Apache instances.
Installing ModSecurity with OWASP Core Rule Set Step 1: Update Repositories On Ubuntu/ Debian:"/>
<meta name="keywords" content="python python,compliance windows 10,cybersecurity hardening,automation hardening,python hardening,compliance compliance,compliance automation,automation compliance,compliance hardening,powershell security,windows 10 python,automation automation,automation windows 10,security hardening,windows 10 automation,powershell compliance,windows 10 powershell,security powershell,windows 10 cybersecurity,windows 10 hardening,automation python,security python,hardening powershell,compliance cybersecurity,cybersecurity security,python windows 10,windows 10 security,automation powershell,hardening compliance,security security,windows 10 compliance,hardening cybersecurity,powershell automation,security windows 10,python powershell,compliance powershell,powershell python,security cybersecurity,hardening windows 10,cybersecurity compliance,hardening python,hardening automation,security automation,powershell powershell,security compliance,hardening security,windows 10 windows 10,python compliance,powershell cybersecurity,compliance security,cybersecurity python,automation security,cybersecurity cybersecurity,compliance python,cybersecurity windows 10,cybersecurity powershell,python security,python cybersecurity,hardening hardening,automation cybersecurity,python automation,powershell windows 10,powershell hardening,cybersecurity automation,"/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="../../posts/hardening-apache/" />





<link rel="stylesheet" href="../../assets/style.css">


<link rel="stylesheet" href="../../style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../../img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="../../img/favicon.png">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Hardening Apache Web Server"/>
<meta name="twitter:description" content="A collection of example configurations and scripts to aid system administrators in hardening Apache web servers. Apache, out of the box, is surprisingly insecure. Many best practices and security configurations have to be configured manually before rolling Apache out in a production environment. You may use this GitHub repository as a starting point towards securing your Apache instances.
Installing ModSecurity with OWASP Core Rule Set Step 1: Update Repositories On Ubuntu/ Debian:"/>



<meta property="og:title" content="Hardening Apache Web Server" />
<meta property="og:description" content="A collection of example configurations and scripts to aid system administrators in hardening Apache web servers. Apache, out of the box, is surprisingly insecure. Many best practices and security configurations have to be configured manually before rolling Apache out in a production environment. You may use this GitHub repository as a starting point towards securing your Apache instances.
Installing ModSecurity with OWASP Core Rule Set Step 1: Update Repositories On Ubuntu/ Debian:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/hardening-apache/" />
<meta property="article:published_time" content="2020-07-27T10:15:03-07:00" />
<meta property="article:modified_time" content="2020-07-27T10:15:03-07:00" /><meta property="og:site_name" content="simeononsecurity" />



<meta name="author" content="SimeonOnSecurity"/>
<meta name="revisit-after" content="1 days"/>
<meta name="robots" content="index,follow" content="all"/>
<meta name="distribution" content="article"/>
<meta name="copyright" content="SimeonOnSecurity"/>  
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="SimeonOnSecurity"/>
<meta property="og:image" content="/img/banner.png"/>
<meta property="og:url" content="https://simeononsecurity.ch"/>
<link rel="author" href="https://github.com/simeononsecurity"/>
<link rel="publisher" href="https://github.com/simeononsecurity"/>
<link rel="canonical" href="https://simeononsecurity.ch"/>
<link rel="icon" href="../../img/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon"/>
<link rel="alternate" type="application/rss+xml" title="simeononsecurity" href="../../sitemap.xml"/>
  
  <link href="data:image/x-icon;base64,AAABAAEAEBAQAAEABAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAD9/f0AAAAAAP///wDx8fEA+vr6APz8/ADu7u4A/v7+APDw8AD5+fkA8vLyAAwM6AD7+/sAAAAAAAAAAAAAAAAAEREREREREREREbuxG7sRERERsRuxGxEREREbsRuxERERZxERERFAEREmEREREagREREYK7YhERERESUSYWIRERFnaBYhJkAREVFZNTU1GhEREcERERwRERERG3Z2sRERERG7u7u7EREREbu7u7sRERERG7u7sRERERERERERERHxjwAA4AcAAOAHAADAAwAAgAEAAIABAADAAwAAwAMAAIABAACAAQAAwAMAAMADAADgBwAA4AcAAPAPAAD4HwAA" rel="icon" type="image/x-icon" /> <link href="../../favicon.ico" rel="icon" type="image/x-icon" />
  <script data-ad-client="ca-pub-4092442123207538" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-173461240-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-173461240-1');
  ga('set', 'userId', 'USER_ID'); 
  gtag('set', {'user_id': 'USER_ID'}); 
</script>


  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a href="../../" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
    <span class="logo__text">simeononsecurity</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="../../about">About</a></li>
        
      
        
          <li><a href="../../posts">Posts</a></li>
        
      
      
        <ul class="menu__sub-inner">
          <li class="menu__sub-inner-more-trigger">
            Show more
            <span class="menu__sub-inner-more-trigger-icon"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
          </li>

          <ul class="menu__sub-inner-more hidden">
            
              
                <li><a href="../../recommendations">Recommendations</a></li>
              
            
              
                <li><a href="../../sitemap.xml">Sitemap</a></li>
              
            
          </ul>
        </ul>
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="../../about">About</a></li>
      
    
      
        <li><a href="../../posts">Posts</a></li>
      
    
      
        <li><a href="../../recommendations">Recommendations</a></li>
      
    
      
        <li><a href="../../sitemap.xml">Sitemap</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <div class="post">
    <h1 class="post-title"><a href="../../posts/hardening-apache/">Hardening Apache Web Server</a></h1>
    <div class="post-meta">
      
        <span class="post-date">
          2020-07-27
        </span>

        
          
        
      

      
      
        <span class="post-read-time">— 3 min read</span>
      
    </div>

    

    

    <div class="post-content">
      
        <h2>Table of Contents</h2>
        <aside class="table-of-contents"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#a-collection-of-example-configurations-and-scripts-to-aid-system-administrators-in-hardening-apache-web-servers">A collection of example configurations and scripts to aid system administrators in hardening Apache web servers.</a></li>
      </ul>
    </li>
    <li><a href="#installing-modsecurity-with-owasp-core-rule-set">Installing ModSecurity with OWASP Core Rule Set</a>
      <ul>
        <li><a href="#step-1-update-repositories">Step 1: Update Repositories</a></li>
        <li><a href="#step-2-installing-modsecurity-for-apache">Step 2: Installing ModSecurity for Apache</a></li>
        <li><a href="#step-3-configure-modsecurity">Step 3: Configure ModSecurity</a></li>
        <li><a href="#step-4-downloading-and-installing-owasp-modsecurity-core-rule-set">Step 4: Downloading and Installing OWASP ModSecurity Core Rule Set</a></li>
        <li><a href="#step-5-additional-reading-material">Step 5: Additional Reading Material</a></li>
      </ul>
    </li>
    <li><a href="#ssl-certificates">SSL Certificates</a>
      <ul>
        <li><a href="#self-signed">Self Signed</a></li>
        <li><a href="#automate-with-letsencrypt-and-certbot">Automate with LetsEncrypt and Certbot</a></li>
        <li><a href="#step-2-choose-how-youd-like-to-run-certbot">Step 2: Choose how you&rsquo;d like to run Certbot</a></li>
      </ul>
    </li>
  </ul>
</nav></aside>
      
      <h3 id="a-collection-of-example-configurations-and-scripts-to-aid-system-administrators-in-hardening-apache-web-servers">A collection of example configurations and scripts to aid system administrators in hardening Apache web servers.</h3>
<p>Apache, out of the box, is surprisingly insecure. Many best practices and security configurations have to be configured manually before rolling Apache out in a production environment. You may use this GitHub repository as a starting point towards securing your Apache instances.</p>
<h2 id="installing-modsecurity-with-owasp-core-rule-set">Installing ModSecurity with OWASP Core Rule Set</h2>
<h3 id="step-1-update-repositories">Step 1: Update Repositories</h3>
<p><strong>On Ubuntu/ Debian:</strong></p>
<pre><code>sudo apt-get update -y
</code></pre><p><strong>On CentOS/RHEL:</strong></p>
<pre><code>sudo yum update -y
</code></pre><h3 id="step-2-installing-modsecurity-for-apache">Step 2: Installing ModSecurity for Apache</h3>
<p><strong>On Ubuntu/ Debian:</strong></p>
<pre><code>sudo apt-get install -y libapache2-modsecurity
sudo systemctl restart apache2
</code></pre><p><strong>On CentOS/RHEL:</strong></p>
<pre><code>sudo yum install -y mod_security
sudo systemctl restart httpd.service
</code></pre><h3 id="step-3-configure-modsecurity">Step 3: Configure ModSecurity</h3>
<p>ModSecurity by default is only configured to log events from the default rules. We&rsquo;ll have to edit the configuration file to modify the rules to detect and block malicious traffic.</p>
<p><strong>Copy and rename the file:</strong></p>
<pre><code>sudo cp /etc/modsecurity/modsecurity.conf-recommended /etc/modsecurity/modsecurity.conf
</code></pre><p><strong>Change the ModSecurity detection mode by editing the configuration file:</strong></p>
<pre><code>sudo nano /etc/modsecurity/modsecurity.conf
</code></pre><p>Change &ldquo;DetectionOnly&rdquo; to &ldquo;On&rdquo;</p>
<pre><code>SecRuleEngine DetectionOnly
</code></pre><pre><code>SecRuleEngine On
</code></pre><p>If you&rsquo;re using nano you may hit <strong>CTRL+X</strong>, then <strong>Y</strong> and <strong>Enter</strong> to save and exit.</p>
<p><strong>Restart Apache</strong></p>
<p>On Ubuntu\ Debian:</p>
<pre><code>sudo systemctl restart apache2
</code></pre><p>On CentOS\ RHEL:</p>
<pre><code>sudo systemctl restart httpd.service
</code></pre><h3 id="step-4-downloading-and-installing-owasp-modsecurity-core-rule-set">Step 4: Downloading and Installing OWASP ModSecurity Core Rule Set</h3>
<pre><code>cd /apache/conf
wget https://github.com/coreruleset/coreruleset/archive/v3.3.0.tar.gz
tar -xvzf v3.3.0.tar.gz
sudo ln -s coreruleset-3.3.0 /apache/conf/crs
cp crs/crs-setup.conf.example crs/crs-setup.conf
rm v3.3.0.tar.gz
</code></pre><p><strong>Restart Apache</strong></p>
<p>On Ubuntu\ Debian:</p>
<pre><code>sudo systemctl restart apache2
</code></pre><p>On CentOS\ RHEL:</p>
<pre><code>sudo systemctl restart httpd.service
</code></pre><h3 id="step-5-additional-reading-material">Step 5: Additional Reading Material</h3>
<p><strong>Additional installation instructions:</strong></p>
<p><a href="https://owasp.org/www-project-modsecurity-core-rule-set/">Install OWASP ModSecurity Core Rule Set</a></p>
<p><a href="https://phoenixnap.com/kb/setup-configure-modsecurity-on-apache">Install ModSecurity</a></p>
<h2 id="ssl-certificates">SSL Certificates</h2>
<h3 id="self-signed">Self Signed</h3>
<p>Following the instructions from <a href="https://www.digitalocean.com/community/tutorials/how-to-create-a-self-signed-ssl-certificate-for-apache-in-ubuntu-16-04">Digital Ocean</a></p>
<p>For this tutorial, I&rsquo;m assuming you&rsquo;re going to be using the <strong>example.com.conf</strong> file from the repository.</p>
<h4 id="step-1-create-the-ssl-certificate">Step 1: Create the SSL certificate</h4>
<pre><code>sudo openssl req -x509 -nodes -days 365 -newkey rsa:4096 -keyout /etc/ssl/private/apache-selfsigned.key -out /etc/ssl/certs/apache-selfsigned.crt
</code></pre><p><strong>Fill out the prompts appropriately. The most important line is the one that requests the Common Name (e.g. server FQDN or YOUR name). You need to enter the domain name associated with your server or, more likely, your server’s public IP address.</strong>
If using for the IP access only certificate in the example.com.conf please use <strong>&ldquo;NA&rdquo;</strong> for all values where posible.</p>
<h4 id="perfect-forward-secrecy-configuration">Perfect Forward Secrecy Configuration</h4>
<pre><code>sudo openssl dhparam -out /etc/ssl/certs/dhparam.pem 4096
</code></pre><h3 id="automate-with-letsencrypt-and-certbot">Automate with LetsEncrypt and Certbot</h3>
<p>Following the tutorial from <a href="https://certbot.eff.org/lets-encrypt/ubuntubionic-apache.html">Certbot</a></p>
<h4 id="step-1-install-certbot">Step 1: Install Certbot</h4>
<pre><code>sudo apt-get update -y
sudo apt-get install software-properties-common
sudo add-apt-repository universe
sudo add-apt-repository ppa:certbot/certbot
sudo apt-get update
sudo apt-get install -y certbot python3-certbot-apache
</code></pre><h3 id="step-2-choose-how-youd-like-to-run-certbot">Step 2: Choose how you&rsquo;d like to run Certbot</h3>
<h5 id="either-get-and-install-your-certificates">Either get and install your certificates&hellip;</h5>
<pre><code>sudo certbot --apache
</code></pre><h5 id="or-just-get-a-certificate">Or, just get a certificate</h5>
<pre><code>sudo certbot certonly --apache
</code></pre><h4 id="step-3-test-automatic-renewal">Step 3: Test automatic renewal</h4>
<pre><code>sudo certbot renew --dry-run
</code></pre>
    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h">Read other posts</span>
            <hr />
          </div>
          <div class="pagination__buttons">
            
              <span class="button previous">
                <a href="../../posts/oracle-jre-8-stig/">
                  <span class="button__icon">←</span>
                  <span class="button__text">Oracle Jre 8 Stig</span>
                </a>
              </span>
            
            
              <span class="button next">
                <a href="../../posts/cve-2020-1350_kb4569509_dns_server_vulnerability/">
                  <span class="button__text">CVE-2020-1350 KB4569509 DNS Server Vulnerability</span>
                  <span class="button__icon">→</span>
                </a>
              </span>
            
          </div>
        </div>
      
    


    
      
        

      
    

    </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <a href="../../" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
    <span class="logo__text">simeononsecurity</span>
    <span class="logo__cursor"></span>
  
</a>

      <div class="copyright">
        <span>© 2020 Powered by <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a></span>
      </div>
    
  </div>
</footer>

<script src="../../assets/main.js"></script>
<script src="../../assets/prism.js"></script>


      
    </div>

    
  </body>
</html>
