---
title: "Secure Coding Guidelines for Ansible: Best Practices"
date: 2023-03-02
toc: true
draft: false
description: "Learn the best practices for writing secure code with Ansible, a popular tool for configuration management and deployment."
tags: ["Secure coding", "Ansible", "Configuration management", "Deployment", "Least privilege principle", "Ansible Vault", "Strong passwords", "Access control", "Version control system", "Secure communication protocols", "SSH", "WinRM", "TLS certificates", "Sanitize user input", "Input validation", "Error handling", "Secure coding practices", "Code injection", "Secure coding guidelines", "Infrastructure security"]
cover: "/img/cover/A_cartoon_image_of_a_castle_protected_by_a_shield.png"
coverAlt: " A cartoon image of a castle protected by a shield, representing the security measures in place for infrastructure managed by Ansible."
coverCaption: ""
---
```bash
ansible-vault create secret.yml
```
```yml
db_password: "{{ vault_db_password }}"
```
```yaml
- name: Sanitize user input
  vars:
    user_input: "Hello! This is a string with non-alphanumeric characters."
    sanitized_input: "{{ user_input | regex_replace('[^A-Za-z0-9]', '') }}"
  debug:
    var: sanitized_input
```

 À mesure que les organisations évoluent vers l'automatisation, **Ansible** est devenu un choix populaire pour la **gestion de la configuration** et le **déploiement**. Cependant, comme tout logiciel, Ansible n'est pas à l'abri des failles de sécurité. L'écriture de **code sécurisé** est cruciale pour assurer la sécurité et la fiabilité de l'infrastructure gérée par Ansible. Cet article fournit des **instructions** pour écrire du **code sécurisé** à l'aide d'Ansible.  ## Comprendre la sécurité Ansible  Avant de plonger dans les directives, il est important de comprendre les fonctions de sécurité d'Ansible. Ansible fournit un **chiffrement** pour la communication entre les nœuds de contrôle et les nœuds gérés. Ansible fournit également un **stockage sécurisé** de **secrets** et d'autres informations sensibles à l'aide du **Vault**. De plus, Ansible dispose d'un **mécanisme de sandboxing** pour se protéger contre l'exécution de code potentiellement malveillant.  Cependant, ces fonctionnalités de sécurité ne dispensent pas les développeurs d'écrire du code sécurisé. Le respect des directives permet aux développeurs d'écrire un code sécurisé qui complète les fonctionnalités de sécurité intégrées d'Ansible.  ## Instruction 1 : Utiliser la dernière version d'Ansible  Ansible est toujours mis à jour pour corriger les failles de sécurité et les bogues. L'utilisation de la dernière version d'Ansible garantit que les développeurs ont aux derniers correctifs et améliorations de sécurité.  Les développeurs doivent vérifier régulièrement les mises à jour et les installer dès que possible. Ils peuvent également s'abonner à la liste de diffusion Ansible Security Announcements pour recevoir des notifications sur les mises à jour de sécurité. La mise à jour vers la dernière version d'Ansible est une étape simple qui peut améliorer considérablement la sécurité de l'infrastructure gérée par Ansible.  ## Directive 2 : Suivez le principe du moindre privilège  Le **principe du privilège moindre** est un principe fondamental de sécurité qui s'applique à Ansible. Ce principe stipule qu'un utilisateur ne doit disposer que du niveau d'accès minimum nécessaire pour effectuer sa fonction professionnelle. Ce principe s'applique également à Ansible. Les développeurs doivent accorder aux nœuds gérés le niveau d'accès minimum requis pour effectuer les tâches nécessaires.  Par exemple, si un playbook ne nécessite qu'un accès en lecture à un fichier spécifique, les développeurs ne doivent accorder qu'un accès en lecture au fichier et non un accès en écriture ou en exécution. Les développeurs doivent également limiter le nombre d'utilisateurs ayant accès à Ansible. L'accès doit être limité aux utilisateurs autorisés qui doivent gérer l'infrastructure à l'aide d'Ansible.  Ansible contient plusieurs mécanismes pour mettre en œuvre le principe du moindre privilège, comme la directive « devenir ». La directive "devenir" permet aux développeurs d'exécuter des tâches avec les privilèges d'un autre utilisateur, comme "sudo". Les développeurs doivent utiliser la directive « devenir » uniquement lorsque cela est nécessaire et fournir uniquement le niveau de privilèges nécessaires.  En mettant en œuvre le principe du moindre privilège, les développeurs peuvent limiter les dommages potentiels causés par un attaquant en cas de faille de sécurité. Cette directive peut améliorer efficacement la sécurité de l'infrastructure gérée par Ansible.  ## Instruction 3 : Utiliser Ansible Vault pour les informations sensibles  Les informations sensibles telles que les mots de passe, les clés API et les certificats ne doivent pas être transposées en texte brut dans les playbooks Ansible. Le stockage d'informations sensibles en texte brut peut compromettre la sécurité de l'infrastructure gérée par Ansible. Ansible fournit le **Vault** pour stocker les informations sensibles en toute sécurité.  Le coffre-fort crypte les informations sensibles avec un mot de passe ou un fichier clé. Les développeurs peuvent utiliser la commande `ansible-vault` pour créer un nouveau fichier crypté, modifier un fichier crypté existant ou afficher un fichier crypté. La commande `ansible-vault` peut également être utilisée pour chiffrer ou déchiffrer des variables individuelles. Par exemple, pour créer un nouveau fichier chiffré, les développeurs peuvent utiliser la commande suivante :   Cette commande crée un nouveau fichier crypté nommé `secret.yml`. Les développeurs peuvent modifier ce fichier à l'aide de la commande "ansible-vault edit". Ils seront invités à saisir le mot de passe du coffre-fort.  Les développeurs doivent également s'assurer que les mots de passe et les fichiers clés sont stockés en toute sécurité. Les mots de passe et les fichiers clés ne doivent pas être stockés en texte brut. Ils doivent être stockés dans un emplacement sécurisé, tel qu'un gestionnaire de mots de passe ou un serveur de fichiers sécurisés.  L'utilisation de Vault pour stocker des informations sensibles est une étape cruciale dans la sécurisation de l'infrastructure gérée par Ansible. En suivant cette directive, les développeurs peuvent s'assurer que les informations sensibles ne sont pas exposées en texte brut et ne sont accessibles qu'aux utilisateurs autorisés.  ## Directive 4 : Utilisez des mots de passe forts  Les mots de passe utilisés pour l'authentification doivent être **forts** et **uniques**. L'utilisation de mots de passe faibles ou courants peut compromettre la sécurité de l'infrastructure gérée par Ansible. Les développeurs doivent également éviter d'utiliser des mots de passe par défaut ou des mots de passe codés en dur dans les playbooks. Les mots de passe doivent être stockés en toute sécurité à l'aide du coffre-fort.  Un mot de passe fort doit comporter au moins 12 caractères et contenir une combinaison de lettres majuscules et minuscules, de chiffres et de caractères spéciaux. Les développeurs doivent également éviter d'utiliser des informations facilement devinables, telles que des noms ou des anniversaires, dans les mots de passe. Ils peuvent utiliser un gestionnaire de mots de passe pour générer des mots de passe forts et uniques.  Les mots de passe utilisés dans les playbooks doivent être stockés dans un format crypté à l'aide du coffre-fort. Les développeurs doivent également éviter de coder en dur les mots de passe dans les playbooks. Au lieu de cela, ils doivent utiliser des variables pour stocker les mots de passe et les référencer dans des playbooks. Par exemple, les développeurs peuvent définir une variable nommée "db_password" dans un fichier chiffré séparé et la référencer dans le playbook en utilisant la syntaxe suivante :  Cette syntaxe référencera la variable `db_password` du fichier chiffré et la décryptera à l'aide de Vault.  En utilisant des mots de passe forts et en les stockant en toute sécurité, les développeurs peuvent empêcher l'accès non autorisé à l'infrastructure gérée par Ansible. Cette directive est une étape simple qui peut améliorer significativement la sécurité de l'infrastructure gérée par Ansible.   ## Règle 5 : Limiter l'accès aux Playbooks  L'accès aux playbooks Ansible doit être limité aux utilisateurs autorisés. Les développeurs doivent utiliser un **système de contrôle de version** tel que **Git** pour gérer les playbooks. Git fournit des fonctionnalités de **contrôle d'accès** et d'**audit** qui peuvent aider à appliquer les politiques de sécurité.  ## Directive 6 : Utiliser des protocoles de communication sécurisés  Ansible prend en charge plusieurs protocoles de communication, notamment SSH et WinRM. SSH est le protocole recommandé pour les hôtes Linux et macOS. WinRM est le protocole recommandé pour les hôtes Windows. Les développeurs doivent s'assurer que la communication entre les nœuds de contrôle et les nœuds gérés est **chiffrée**.  SSH est un protocole de communication sécurisé qui crypte la communication entre les nœuds de contrôle et les nœuds gérés. Les développeurs doivent utiliser des clés SSH fortes pour l'authentification. Les clés SSH doivent avoir une longueur minimale de 2048 bits. Les développeurs doivent également désactiver l'authentification par mot de passe pour SSH.  WinRM est un protocole de communication sécurisé qui crypte la communication entre les nœuds de contrôle et les nœuds gérés. Les développeurs doivent utiliser WinRM sur HTTPS pour s'assurer que la communication est chiffrée. Ils doivent également utiliser des certificats solides pour l'authentification.  Les développeurs doivent également s'assurer que les certificats TLS utilisés pour la communication HTTPS sont valides et n'ont pas expiré. Ils peuvent utiliser des outils tels que "openssl" pour générer et gérer des certificats TLS.  L'utilisation des protocoles de communication sécurisés est une étape cruciale dans la sécurisation des infrastructures gérées par Ansible. En suivant cette directive, les développeurs peuvent s'assurer que la communication entre les nœuds de contrôle et les nœuds gérés est cryptée et sécurisée.  ## Directive 7 : Vérifier l'identité des hôtes  Les développeurs doivent vérifier les identités des nœuds gérés avant de les autoriser à se connecter aux nœuds de contrôle. Ansible fournit plusieurs mécanismes de vérification des identités des hôtes, notamment les **empreintes de clé SSH** et les **certificats TLS**. Les développeurs doivent également s'assurer que les configurations SSH et TLS sont à jour et sécurisées.  Les empreintes digitales de clé SSH sont des identifiants uniques des clés SSH utilisés par les nœuds gérés pour l'authentification. Les développeurs doivent vérifier les empreintes digitales des clés SSH des nœuds gérés avant de les autoriser à se connecter aux nœuds de contrôle. Ils peuvent utiliser la commande `ssh-keygen` pour générer des empreintes de clé SSH et les comparer aux empreintes fournies par les nœuds gérés.  Les certificats TLS sont utilisés par les nœuds gérés pour s'authentifier auprès des nœuds de contrôle. Les développeurs doivent s'assurer que les certificats TLS utilisés par les nœuds gérés sont valides et n'ont pas expiré. Ils doivent également s'assurer que les nœuds de contrôle font confiance aux certificats TLS utilisés par les nœuds gérés.  Les développeurs doivent également s'assurer que les configurations SSH et TLS sont à jour et sécurisées. Les configurations SSH et TLS doivent utiliser des algorithmes de chiffrement et d'authentification solides. Ils doivent également être configurés pour rejeter les chiffres et les faibles.  La vérification des identités des nœuds gérée est une étape cruciale dans la sécurisation de l'infrastructure gérée par Ansible. En suivant cette directive, les développeurs peuvent empêcher les attaques de l'homme du milieu et s'assurer que seuls les nœuds autorisés peuvent se connecter aux nœuds de contrôle.  ## Conseil 8 : Nettoyer les entrées de l'utilisateur  Les développeurs doivent nettoyer les entrées des utilisateurs pour empêcher l'**injection de code** et d'autres failles de sécurité. Les développeurs doivent également utiliser des **entrées validées** dans la mesure du possible pour réduire le risque de failles de sécurité.  ## Directive 9 : Suivez les pratiques de codage sécurisé  Les développeurs doivent suivre les **pratiques de codage sécurisés** telles que la **validation des entrées**, la **gestion des erreurs** et le **nettoyage** des entrées. Les développeurs doivent également suivre les **directives de codage sécurisé** pour le langage de programmation utilisé dans Ansible.  Les développeurs doivent nettoyer les entrées des utilisateurs pour empêcher l'**injection de code** et d'autres failles de sécurité. L'injection de code est un type d'attaque dans lequel un attaquant injecte un code malveillant dans une application en exploitant les vulnérabilités de l'entrée utilisateur. Les développeurs doivent également utiliser des entrées validées chaque fois que possible pour réduire le risque de vulnérabilités de sécurité.  Les développeurs peuvent utiliser le filtre `regex_replace` dans Ansible pour nettoyer l'entrée de l'utilisateur. Le filtre `regex_replace` permet aux développeurs de remplacer les modèles dans les chaînes par d'autres modèles. Par exemple, pour remplacer tous les caractères non alphanumériques d'une chaîne par une chaîne vide, les développeurs peuvent utiliser le code suivant :  Dans cet exemple, le filtre `regex_replace` est utilisé pour remplacer tous les caractères non alphanumériques de la variable `user_input` par une chaîne vide. L'entrée nettoyée est stockée dans la variable `sanitized_input`.  Les développeurs peuvent également utiliser la validation des entrées pour réduire le risque de failles de sécurité. La validation des entrées implique de vérifier les entrées de l'utilisateur pour s'assurer qu'elles répondent à certains critères. Par exemple, les développeurs peuvent valider la saisie de l'utilisateur pour s'assurer qu'elle ne contient que des caractères alphanumériques. La validation des entrées peut être implémentée à l'aide de conditions et d'expressions régulières Ansible.  En nettoyant les entrées utilisateur et en utilisant des entrées validées, les développeurs peuvent empêcher l'injection de code et d'autres vulnérabilités de sécurité dans les playbooks Ansible. Cette directive est une étape simple qui peut améliorer significativement la sécurité de l'infrastructure gérée par Ansible. ______  ## Conclusion  Ansible est un outil puissant pour la gestion de la configuration et le déploiement, mais il est important d'écrire du code sécurisé pour assurer la sécurité et la fiabilité de l'infrastructure gérée par Ansible. Le respect des directives fournies dans cet article permet aux développeurs d'écrire un code sécurisé qui complète les fonctionnalités de sécurité intégrées d'Ansible.  N'oubliez pas de toujours utiliser la dernière version d'Ansible, de suivre le principe du moindre privilège, d'utiliser Ansible Vault pour les informations sensibles, d'utiliser des mots de passe forts, de limiter l'accès aux playbooks, d 'Utiliser des protocoles de communication sécurisés, vérifier les identités des hôtes, nettoyer les entrées des utilisateurs et suivre les pratiques de codage sécurisés. . Ces directives envoient les développeurs à écrire du code sécurisé et à protéger leur infrastructure des failles de sécurité.  En suivant ces directives, les organisations peuvent s'assurer que leur infrastructure est gérée par Ansible est sécurisée et fiable. Grâce au code sécurisé et aux fonctionnalités de sécurité intégrées d'Ansible, les organisations peuvent tirer parti des avantages de l'automatisation sans sacrifier la sécurité.  ## Les références  - [Documentation Ansible](https://docs.ansible.com/) - [Documentation Ansible Vault](https://docs.ansible.com/ansible/latest/user_guide/vault.html) - [Documentation Git](https://git-scm.com/doc) - [Documentation OpenSSH](https://www.openssh.com/) - [Documentation sur la sécurité de la couche de transport (TLS)] (https://tools.ietf.org/html/rfc8446) - [Documentation sur l'injection de code OWASP](https://owasp.org/www-community/attacks/Code_Injection)