---
title: "Secure Coding Guidelines for Ansible: Best Practices"
date: 2023-03-02
toc: true
draft: false
description: "Learn the best practices for writing secure code with Ansible, a popular tool for configuration management and deployment."
tags: ["Secure coding", "Ansible", "Configuration management", "Deployment", "Least privilege principle", "Ansible Vault", "Strong passwords", "Access control", "Version control system", "Secure communication protocols", "SSH", "WinRM", "TLS certificates", "Sanitize user input", "Input validation", "Error handling", "Secure coding practices", "Code injection", "Secure coding guidelines", "Infrastructure security"]
cover: "/img/cover/A_cartoon_image_of_a_castle_protected_by_a_shield.png"
coverAlt: " A cartoon image of a castle protected by a shield, representing the security measures in place for infrastructure managed by Ansible."
coverCaption: ""
---
```bash
ansible-vault create secret.yml
```
```yml
db_password: "{{ vault_db_password }}"
```
```yaml
- name: Sanitize user input
  vars:
    user_input: "Hello! This is a string with non-alphanumeric characters."
    sanitized_input: "{{ user_input | regex_replace('[^A-Za-z0-9]', '') }}"
  debug:
    var: sanitized_input
```

 A medida que las organizaciones avanzan hacia la automatización, **Ansible** se ha convertido en una opción popular para la **administración de configuración** y la **implementación**. Sin embargo, como cualquier software, Ansible no es inmune a las vulnerabilidades de seguridad. Escribir **código seguro** es crucial para garantizar la seguridad y confiabilidad de la infraestructura administrada por Ansible. Este artículo proporciona **directrices** para escribir **código seguro** con Ansible.  ## Comprender la seguridad de Ansible  Antes de sumergirse en las pautas, es importante comprender las funciones de seguridad de Ansible. Ansible proporciona **cifrado** para la comunicación entre los nodos de control y los nodos administrados. Ansible también proporciona **almacenamiento seguro** de **secretos** y otra información confidencial mediante **Vault**. Además, Ansible tiene un **mecanismo de espacio aislado** para proteger contra la ejecución de un código potencialmente malicioso.  Sin embargo, estas funciones de seguridad no exigen a los desarrolladores de escribir código seguro. Cumplir con las siguientes pautas ayudará a los desarrolladores a escribir un código seguro que complementará las funciones de seguridad integradas de Ansible.  ## Directriz 1: Use la última versión de Ansible  Ansible se actualiza constantemente para corregir vulnerabilidades y errores de seguridad. El uso de la última versión de Ansible garantiza que los desarrolladores tendrán acceso a las últimas correcciones y mejoras de seguridad.  Los desarrolladores deben comprobar periódicamente si hay actualizaciones e instalarlas lo antes posible. También pueden suscribirse a la lista de correo de anuncios de seguridad de Ansible para recibir notificaciones sobre actualizaciones de seguridad. Actualizar a la última versión de Ansible es un paso simple que puede mejorar significativamente la seguridad de la infraestructura administrada por Ansible.  ## Directriz 2: Siga el principio de privilegio mínimo  El **principio de privilegio mínimo** es un principio fundamental de seguridad que se aplica a Ansible. Este principio establece que un usuario solo debe tener el nivel mínimo de acceso necesario para realizar su función laboral. Este principio también se aplica a Ansible. Los desarrolladores deben otorgar a los nodos administradores el nivel mínimo de acceso requerido para realizar las tareas necesarias.  Por ejemplo, si un libro de jugadas solo requiere acceso de lectura a un archivo específico, los desarrolladores solo deben otorgar acceso de lectura al archivo y no acceso de escritura o ejecución. Los desarrolladores también deben limitar la cantidad de usuarios con acceso a Ansible. El acceso debe limitarse a los usuarios autorizados que necesitan administrar la infraestructura mediante Ansible.  Ansible proporciona varios mecanismos para implementar el principio de privilegios mínimos, como la directiva `become`. La directiva `become` permite a los desarrolladores ejecutar tareas con privilegios de otro usuario, como `sudo`. Los desarrolladores deben usar la directiva `become` solo cuando sea necesario y proporcionar solo el nivel necesario de privilegios.  Al implementar el principio de privilegios mínimos, los desarrolladores pueden limitar el daño potencial causado por un atacante en caso de una brecha de seguridad. Esta directriz puede mejorar significativamente la seguridad de la infraestructura administrada por Ansible.  ## Directriz 3: Use Ansible Vault para información confidencial  La información confidencial, como contraseñas, claves de API y certificados, no debe almacenarse en texto sin formato en los playbooks de Ansible. El almacenamiento de información confidencial en texto sin formato puede comprometer la seguridad de la infraestructura administrada por Ansible. Ansible proporciona la **Vault** para almacenar información confidencial de forma segura.  The Vault cifra la información confidencial con una contraseña o un archivo de clave. Los desarrolladores pueden usar el comando `ansible-vault` para crear un nuevo archivo cifrado, editar un archivo cifrado existente o ver un archivo cifrado. El comando `ansible-vault` también se puede utilizar para cifrar o descifrar variables individuales. Por ejemplo, para crear un nuevo archivo cifrado, los desarrolladores pueden usar el siguiente comando:   Este comando creará un nuevo archivo encriptado llamado `secret.yml`. Los desarrolladores pueden editar este archivo usando el comando `ansible-vault edit`. Se les pedirá que ingresen la contraseña de la Bóveda.  Los desarrolladores también deben asegurarse de que las contraseñas y los archivos clave se almacenen de forma segura. Las contraseñas y los archivos clave no deben almacenarse en texto sin formato. Deben almacenarse en una ubicación segura, como un administrador de contraseñas o un servidor de archivos seguro.  El uso de Vault para almacenar información confidencial es un paso crucial para proteger la infraestructura administrada por Ansible. Al seguir esta guía, los desarrolladores pueden asegurarse de que la información confidencial no se exponga en texto sin formato y solo sea accesible para usuarios autorizados.  ## Directriz 4: Usar contraseñas seguras  Las contraseñas utilizadas para la autenticación deben ser **fuertes** y **únicas**. El uso de contraseñas débiles o comunes puede comprometer la seguridad de la infraestructura administrada por Ansible. Los desarrolladores también deben evitar el uso de contraseñas definidas o contraseñas codificadas en los libros de jugadas. Las contraseñas deben almacenarse de forma segura utilizando la Bóveda.  Una contraseña segura debe tener un mínimo de 12 caracteres y contener una combinación de letras mayúsculas y minúsculas, números y caracteres especiales. Los desarrolladores también deben evitar el uso de información fácil de adivinar, como nombres o cumpleaños, en las contraseñas. Pueden usar un administrador de contraseñas para generar contraseñas seguras y únicas.  Las contraseñas utilizadas en los libros de jugadas deben almacenarse en formato cifrado mediante Vault. Los desarrolladores también deben evitar codificar contraseñas en los libros de jugadas. En su lugar, puede usar variables para almacenar contraseñas y hacer referencia a ellas en libros de jugadas. Por ejemplo, los desarrolladores pueden definir una variable llamada `db_password` en un archivo encriptado separado y hacer referencia a ella en el libro de jugadas usando la siguiente sintaxis:  Esta sintaxis hará referencia a la variable `db_password` del archivo encriptado y lo descifrará usando Vault.  Al usar contraseñas seguras y almacenarlas de forma segura, los desarrolladores pueden evitar el acceso no autorizado a la infraestructura administrada por Ansible. Esta directriz es un paso simple que puede mejorar significativamente la seguridad de la infraestructura administrada por Ansible.   ## Directriz 5: Limite el acceso a los Playbooks  El acceso a los playbooks de Ansible debe limitarse a los usuarios autorizados. Los desarrolladores deben usar un **sistema de control de versiones** como **Git** para administrar libros de jugadas. Git proporciona características de **control de acceso** y **auditoría** que pueden ayudar a cumplir las políticas de seguridad.  ## Directriz 6: Uso de protocolos de comunicación seguros  Ansible admite varios protocolos de comunicación, incluidos SSH y WinRM. SSH es el protocolo recomendado para hosts Linux y macOS. WinRM es el protocolo recomendado para hosts de Windows. Los desarrolladores deben asegurarse de que la comunicación entre los nodos de control y los nodos administrados esté **encriptada**.  SSH es un protocolo de comunicación seguro que cifra la comunicación entre los nodos de control y los nodos gestionados. Los desarrolladores deben usar SSH seguras para la autenticación de claves. Las claves SSH deben tener una longitud mínima de 2048 bits. Los desarrolladores también deben deshabilitar la autenticación de contraseña para SSH.  WinRM es un protocolo de comunicación seguro que cifra la comunicación entre los nodos de control y los nodos gestionados. Los desarrolladores deben usar WinRM sobre HTTPS para asegurarse de que la comunicación esté encriptada. También deben usar certificados sólidos para la autenticación.  Los desarrolladores también deben asegurarse de que los certificados TLS utilizados para la comunicación HTTPS sean válidos y no hayan caducado. Pueden usar herramientas como `openssl` para generar y administrar certificados TLS.  El uso de protocolos de comunicación seguros es un paso crucial para proteger la infraestructura administrada por Ansible. Al seguir esta guía, los desarrolladores pueden asegurarse de que la comunicación entre los nodos de control y los nodos administrados esté encriptada y sea segura.  ## Directriz 7: Verificar las identidades de los hosts  Los desarrolladores deben verificar las identidades de los nodos administrados antes de permitirles conectarse a los nodos de control. Ansible proporciona varios mecanismos para verificar las identidades de los hosts, incluidos **huellas dactilares de clave SSH** y **certificados TLS**. Los desarrolladores también deben asegurarse de que las configuraciones de SSH y TLS estén actualizadas y sean seguras.  Las huellas digitales de la clave SSH son identificadores únicos de las claves SSH utilizadas por los nodos administrados para la autenticación. Los desarrolladores deben verificar las huellas dactilares de la clave SSH de los nodos administrados antes de permitirles conectarse a los nodos de control. Pueden usar el comando `ssh-keygen` para generar huellas digitales de claves SSH y compararlas con las huellas digitales mostradas por los nodos administradores.  Los nodos administrados utilizan los certificados TLS para autenticarse en los nodos de control. Los desarrolladores deben asegurarse de que los certificados TLS utilizados por los nodos administradores sean válidos y no hayan caducado. También deben asegurarse de que los nodos de control confíen en los certificados TLS utilizados por los nodos administrados.  Los desarrolladores también deben asegurarse de que las configuraciones de SSH y TLS estén actualizadas y sean seguras. Las configuraciones de SSH y TLS deben utilizar algoritmos de autenticación y cifrado sólidos. También deben configurarse para rechazar tonos y protocolos débiles.  Verificar las identidades de los nodos administrados es un paso crucial para proteger la infraestructura administrada por Ansible. Al seguir esta guía, los desarrolladores pueden evitar los ataques de intermediarios y asegurarse de que solo los nodos administradores autorizados pueden conectarse a los nodos de control.  ## Directriz 8: Desinfecte la entrada del usuario  Los desarrolladores deben desinfectar las entradas de los usuarios para evitar la **inyección de código** y otras vulnerabilidades de seguridad. Los desarrolladores también deben usar **entrada validada** siempre que sea posible para reducir el riesgo de vulnerabilidades de seguridad.  ## Directriz 9: Siga las prácticas de codificación segura  Los desarrolladores deben seguir **prácticas de codificación segura** como **validación de entrada**, **manejo de errores** y **desinfección** de entrada. Los desarrolladores también deben seguir las **directrices de codificación segura** para el lenguaje de programación utilizado en Ansible.  Los desarrolladores deben desinfectar las entradas de los usuarios para evitar la **inyección de código** y otras vulnerabilidades de seguridad. La inyección de código es un tipo de ataque en el que un atacante inyecta código malicioso en una aplicación al explotar las vulnerabilidades en la entrada del usuario. Los desarrolladores también deben usar entradas validadas siempre que sea posible para reducir el riesgo de vulnerabilidades de seguridad.  Los desarrolladores pueden usar el filtro `regex_replace` en Ansible para desinfectar la entrada del usuario. El filtro `regex_replace` permite a los desarrolladores reemplazar patrones en cadenas con otros patrones. Por ejemplo, para reemplazar todos los caracteres no alfanuméricos en una cadena con una cadena vacía, los desarrolladores pueden usar el siguiente código:  En este ejemplo, el filtro `regex_replace` se usa para reemplazar todos los caracteres no alfanuméricos en la variable `user_input` con una cadena vacía. La entrada sanitizada se almacena en la variable `sanitized_input`.  Los desarrolladores también pueden usar la validación de entrada para reducir el riesgo de vulnerabilidades de seguridad. La validación de entrada implica verificar la entrada del usuario para asegurarse de que cumple con ciertos criterios. Por ejemplo, los desarrolladores pueden validar la entrada del usuario para asegurarse de que solo contenga caracteres alfanuméricos. La validación de entrada se puede implementar mediante condicionales de Ansible y expresiones regulares.  Al desinfectar la entrada del usuario y usar la entrada validada, los desarrolladores pueden evitar la inyección de código y otras vulnerabilidades de seguridad en los libros de jugadas de Ansible. Esta directriz es un paso simple que puede mejorar significativamente la seguridad de la infraestructura administrada por Ansible. ______  ## Conclusión  Ansible es una herramienta poderosa para la administración y la implementación de la configuración, pero es importante escribir un código seguro para garantizar la seguridad y la confiabilidad de la infraestructura administrada por Ansible. Cumplir con las pautas proporcionadas en este artículo ayudará a los desarrolladores a escribir un código seguro que complementa las funciones de seguridad integradas de Ansible.  Recuerde usar siempre la última versión de Ansible, siga el principio de privilegios mínimos, use Ansible Vault para información confidencial, use contraseñas seguras, limite el acceso a libros de jugadas, use protocolos de comunicación seguros, verifique las identidades del host, desinfecte la entrada del usuario y siga las prácticas de codificación seguras. . Estas pautas ayudarán a los desarrolladores a escribir un código seguro y a mantener su infraestructura a salvo de vulnerabilidades de seguridad.  Al seguir estas pautas, las organizaciones pueden asegurarse de que su infraestructura administrada por Ansible sea segura y confiable. Con el código seguro y las funciones de seguridad integradas de Ansible, las organizaciones pueden aprovechar los beneficios de la seguridad sin sacrificar la seguridad.  ## Referencias  - [Documentación de Ansible](https://docs.ansible.com/) - [Documentación de Ansible Vault] (https://docs.ansible.com/ansible/latest/user_guide/vault.html) - [Documentación Git](https://git-scm.com/doc) - [Documentación OpenSSH](https://www.openssh.com/) - [Documentación de seguridad de la capa de transporte (TLS)](https://tools.ietf.org/html/rfc8446) - [Documentación de inyección de código OWASP](https://owasp.org/www-community/attacks/Code_Injection)