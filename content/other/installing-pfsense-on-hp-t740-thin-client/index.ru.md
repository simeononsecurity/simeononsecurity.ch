---
title: "Запуск pfSense на тонком клиенте HP t740: советы и руководство по устранению неполадок"
draft: false
toc: true
date: 2023-04-29
description: "Узнайте, как настроить pfSense на тонком клиенте HP t740 и как устранять потенциальные проблемы, такие как проблемы с зависанием и обнаружением SSD."
tags: ["pfSense", "OPNsense", "ЗакаленнаяBSD", "HP т740", "Тонкий клиент", "домашний сервер", "PPPoE", "FreeBSD", "загрузочная подсказка", "loader.conf.local", "нано редактор", "Обнаружение SSD", "Твердотельный накопитель M.2", "Western Digital", "Поиск неисправностей", "после установки", "UART", "ESXi", "Проксмокс"]
cover: "/img/cover/A_cartoon_of_a_wizard_casting_a_spell_to_fix_a_frozen_computer.png"
coverAlt: "Карикатура, на которой волшебник произносит заклинание, чтобы починить зависший компьютер, с речевым пузырем, говорящим, что проблема решена"
coverCaption: ""
canonical: "https://simeononsecurity.com/guides/installing-pfsense-on-hp-t740-thin-client/"
---
 pfSense, OPNsense или HardenedBSD на тонком клиенте HP t740**

Если вы ищете мощное устройство для запуска pfSense, OPNsense или HardenedBSD, тонкий клиент HP t740 может стать для вас подходящим выбором.

## Более мощный и компактный домашний сервер

Тонкий клиент HP t740 — это компактное устройство, которое можно использовать в качестве мощного блока pfSense или компактного домашнего сервера. Он предлагает большую мощность, чем t730 или t620 Plus, что делает его подходящим выбором для работы с PPPoE, особенно если у вас есть оптоволоконный интернет. Он также может предложить путь обновления до 10-гигабитной сети.

## PS/2 зависает

Однако, если вы планируете запускать FreeBSD или ее производные, такие как pfSense, OPNsense или HardenedBSD, на «голом железе» (а не внутри ESXi или Proxmox), вы можете столкнуться с проблемой, когда система зависает при загрузке с сообщением `atkbd0: [GIANT-LOCKED]` К счастью, эту проблему можно решить, введя следующие команды в командной строке загрузки:

```bash
unset hint.uart.0.at
unset hint.uart.1.at
```

*Обратите внимание, что вам нужно отключить оба, иначе он все равно будет зависать при загрузке.*

После установки ОС откройте постустановочную оболочку и выполните следующую команду:

```bash
vi /boot/loader.conf.local
```
Затем добавьте эти две строки:
```bash
hint.uart.0.disabled="1"
hint.uart.1.disabled="1"
```

### Сохранение изменений с помощью VI
Для тех, кто не знаком с vi, вы можете добавить строку, выполнив следующие действия:

Добавление строк `hint.uart.0.disabled="1"` и `hint.uart.1.disabled="1"` к `/boot/loader.conf.local` файл с помощью редактора vi можно сделать, выполнив следующие действия:

1. Откройте терминал в вашей системе FreeBSD.

2. Тип `vi /boot/loader.conf.local` и нажмите Enter, чтобы открыть файл в редакторе vi.

3. Нажмите кнопку `i` клавишу для входа в режим вставки.

4. Переместите курсор в конец файла с помощью клавиш со стрелками.

5. Тип `hint.uart.0.disabled="1"` без кавычек.

6. Нажмите Enter, чтобы начать новую строку.

7. Тип `hint.uart.1.disabled="1"` без кавычек.

8. Нажмите кнопку `Esc` клавишу для выхода из режима вставки.

9. Тип `:wq` и нажмите Enter, чтобы сохранить и выйти из файла.

Это добавит две строки в `/boot/loader.conf.local` файл, который отключит UART и устранит проблему зависания во время загрузки на некоторых устройствах HP t740 «тонкий клиент» при работе с FreeBSD или ее производными, такими как pfSense, OPNsense или HardenedBSD.

Это решит проблему при перезагрузке и обновлении прошивки на pfSense/OPNsense.

## SSD

Если вы используете HP M.2 eMMC, она не будет обнаружена в стандартной установке FreeBSD. В этом случае вам понадобится сторонний твердотельный накопитель M.2. Подойдет любой твердотельный накопитель M.2, SATA или NVMe.

Если вы ищете твердотельный накопитель M.2 стороннего производителя для тонкого клиента HP t740, мы рекомендуем рассмотреть [Western Digital 500GB WD Blue SN570 NVMe](https://amzn.to/44bFCBk) or the [Western Digital 500GB WD Blue SA510 SATA](https://amzn.to/3AEbd0V) Оба эти варианта надежны и должны хорошо работать с вашим устройством. Если вы хотите воспользоваться обоими слотами, вам понадобятся оба. Вы пожертвуете скоростью NVME, но получите некоторую избыточность, которая так важна.

Обратите внимание, что автор этой статьи успешно запустил pfSense CE 2.5.2 и OPNsense 22.1 на своем t740 без каких-либо проблем после выполнения вышеуказанных шагов.

## Устранение неполадок и после установки

После установки, если у вас возникнут проблемы с редактированием файлов, вы можете установить редактор nano с помощью `pkg update` и `pkg install nano` Это поможет вам легко редактировать текстовые файлы.

Чтобы гарантировать, что изменения, внесенные в `/boot/loader.conf.local` файл сохраняется при обновлении версии pfSense, вам нужно добавить следующие строки в `/boot/loader.conf` и `/etc/rc.conf.local` 
```bash
hint.uart.0.disabled="1"
hint.uart.1.disabled="1"
```

Однако иногда редактирование `/boot/loader.conf.local` файл перед перезагрузкой не решает проблему. В таких случаях может потребоваться добавить следующие строки в начале первой загрузки:

```bash
unset hint.uart.0.at
unset hint.uart.1.at
```

Эти шаги должны решить большинство проблем, которые могут возникнуть во время и после процесса установки.

### Использованная литература:
- [HP t740 "Thin Client"](https://www8.hp.com/us/en/thin-clients/t740.html)
- [pfSense](https://www.pfsense.org/)
- [OPNsense](https://opnsense.org/)
- [HardenedBSD](https://hardenedbsd.org/)
- [ServeTheHome](https://www.servethehome.com/hp-t740-thin-client-review/)
- [FreeBSD (or pfSense/OPNsense) on the HP t740 Thin Client](https://www.neelc.org/posts/hp-t740-freebsd/)