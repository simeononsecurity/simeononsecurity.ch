{{ if or (strings.Contains $.Page.RelPermalink "/articles/") (strings.Contains $.Page.RelPermalink "/github/") (strings.Contains $.Page.RelPermalink "/recommendations/") (strings.Contains $.Page.RelPermalink "/writeups/") (strings.Contains $.Page.RelPermalink "/other/") (strings.Contains $.Page.RelPermalink "/blog/") }}
  {{- range first 1 (where (where .Site.Pages ".Params.tags" "intersect" .Params.tags) "Permalink" "!=" .Permalink) -}}
    {{- $.Scratch.Set "has_related" true -}}
  {{- end -}}

  {{ if $.Scratch.Get "has_related" }}
    <div id="related-section">
      <div class="related-content">
        <h3>Related Posts</h3>
        <div class="related-posts-list">
          {{- $num_to_show := .Site.Params.related_content_limit | default 4 -}}
          {{ range first $num_to_show (where (where .Site.Pages ".Params.tags" "intersect" .Params.tags) "Permalink" "!=" .Permalink) }}
          <div class="related">
            {{ if .Params.Cover }}
            {{ $cover := resources.Get (.Params.Cover) }}
            {{ $tiny := ($cover.Resize "480x webp q75") }}
            {{ $small := ($cover.Resize "768x webp q75") }}
            {{ $medium := ($cover.Resize "1024x webp q75") }}
            {{ $large := ($cover.Resize "1366x webp q75") }}
            <div class="related-image">
              <a href="{{ .RelPermalink }}">
                <img
                srcset="
                  {{- with $tiny.RelPermalink -}}{{.}} 480w{{- end -}}
                  {{- with $small.RelPermalink -}}, {{.}} 768w{{- end -}}
                  {{- with $medium.RelPermalink -}}, {{.}} 1024w{{- end -}}
                  {{- with $large.RelPermalink -}}, {{.}} 1366w{{- end -}}"
                sizes="(min-width: 900px) 731px, (min-width: 700px) 527px, calc(80.53vw - 21px)"
                src="{{ $cover.RelPermalink }}"
                alt="{{ .Title }}"
                loading="lazy"
                >
              </a>
            </div>
            {{ end }}
            <div class="related-info">
              <div class="related-date">
                <time datetime="{{ .Date.UTC.Format "2006-01-02T15:04:05-0700" }}">
                  {{ .Date.Format "Jan 2, 2006" }}
                </time>
              </div>
              <div class="related-title">
                <a href="{{ .RelPermalink }}">{{ .Title }}</a>
              </div>
            </div>
          </div>
          {{ end }}
        </div>
      </div>
    </div>
  {{ end }}
{{ end }}
